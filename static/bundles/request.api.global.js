import{r as d}from"./assets/request-DDT5dDpp.js";let i=d;function w(t){i=t}function o(){return i}async function p(t){try{const e=o(),r=t?`/api/config/page_config?lanlan_name=${encodeURIComponent(t)}`:"/api/config/page_config",n=await e.get(r);if(n&&n.success)return n;throw new Error(n?.error||"获取页面配置失败")}catch(e){throw console.error("[getPageConfig] 获取页面配置失败:",e),e}}async function l(){try{return await o().get("/api/characters")}catch(t){throw console.error("[getCharacters] 获取角色配置失败:",t),t}}async function g(){try{const e=await o().get("/api/live2d/models");return Array.isArray(e)?e:[]}catch(t){throw console.error("[getLive2DModels] 获取 Live2D 模型列表失败:",t),t}}async function f(t){try{return(await g()).find(n=>n.name===t)||null}catch(e){return console.error("[findLive2DModelByName] 查找模型失败:",e),null}}async function y(t=!0){const e={timestamp:Date.now(),action:"shutdown"};try{if(t&&typeof navigator<"u"&&navigator.sendBeacon){if(navigator.sendBeacon("/api/beacon/shutdown",JSON.stringify(e)))return console.log("[sendShutdownBeacon] Beacon 信号已发送"),!0;console.warn("[sendShutdownBeacon] Beacon 发送失败，尝试使用 request")}return await o().post("/api/beacon/shutdown",e),console.log("[sendShutdownBeacon] 使用 request 发送关闭信号成功"),!0}catch(r){return console.error("[sendShutdownBeacon] 发送关闭信号失败:",r),!1}}async function h(t){try{const e=await l(),r=t||e.当前猫娘;if(!r)return console.warn("[getCurrentCatgirlConfig] 未找到当前猫娘名称"),null;const n=e.猫娘?.[r];return n?{name:r,...n}:(console.warn(`[getCurrentCatgirlConfig] 未找到角色 ${r} 的配置`),null)}catch(e){return console.error("[getCurrentCatgirlConfig] 获取猫娘配置失败:",e),null}}async function q(t,e){try{const r=await f(e);if(!r)return console.warn(`[shouldReloadModel] 未找到模型 ${e}`),!1;const n=r.path;if(!t)return!0;const s=t.split("/").filter(Boolean).pop()||"",a=n.split("/").filter(Boolean).pop()||"";return!n.includes(s)&&s!==a}catch(r){return console.error("[shouldReloadModel] 检查模型是否需要重新加载失败:",r),!1}}async function m(){try{const e=await o().get("/api/preferences");return Array.isArray(e)?e:[]}catch(t){return console.error("[getUserPreferences] 获取用户偏好失败:",t),[]}}async function A(t,e,r){try{if(!e||typeof e!="object"||!Number.isFinite(e.x)||!Number.isFinite(e.y))return console.error("[saveUserPreferences] 位置值无效:",e),!1;if(!r||typeof r!="object"||!Number.isFinite(r.x)||!Number.isFinite(r.y))return console.error("[saveUserPreferences] 缩放值无效:",r),!1;if(r.x<=0||r.y<=0)return console.error("[saveUserPreferences] 缩放值必须为正数:",r),!1;const n={model_path:t,position:e,scale:r};return(await o().post("/api/preferences",n))?.success===!0}catch(n){return console.error("[saveUserPreferences] 保存用户偏好失败:",n),!1}}async function v(t){try{if(!t)return console.warn("[getEmotionMapping] 模型名称为空"),null;const r=await o().get(`/api/live2d/emotion_mapping/${encodeURIComponent(t)}`);return r&&r.success&&r.config?r:(console.warn("[getEmotionMapping] 获取情绪映射失败:",r),null)}catch(e){return console.error("[getEmotionMapping] 获取情绪映射失败:",e),null}}async function C(t){try{return(await o().post(`/api/steam/set-achievement-status/${t}`,{}))?.success===!0}catch(e){return console.error("[unlockSteamAchievement] 解锁成就失败:",e),!1}}async function P(t){try{return(await o().post("/api/characters/set_microphone",{microphone_id:t}))?.success!==!1}catch(e){return console.error("[setMicrophone] 保存麦克风选择失败:",e),!1}}async function R(){try{return(await o().get("/api/characters/get_microphone"))?.microphone_id||null}catch(t){return console.error("[getMicrophone] 获取麦克风选择失败:",t),null}}async function I(t,e){try{const n=await o().post("/api/emotion/analysis",{text:t,lanlan_name:e});return n?.error?(console.warn("[analyzeEmotion] 情感分析错误:",n.error),null):n}catch(r){return console.error("[analyzeEmotion] 情感分析失败:",r),null}}async function _(t){try{return await o().get(`/api/characters/current_live2d_model?catgirl_name=${encodeURIComponent(t)}`)}catch(e){return console.error("[getCurrentLive2DModel] 获取当前Live2D模型失败:",e),null}}async function M(){try{const e=await o().get("/api/agent/health");return e?.success===!0||e===!0}catch(t){return console.error("[checkAgentHealth] Agent健康检查失败:",t),!1}}async function b(t){try{const r={computer_use:"/api/agent/computer_use/availability",mcp:"/api/agent/mcp/availability"}[t];return r?(await o().get(r))?.ready===!0:(console.warn("[checkAgentCapability] 未知的能力类型:",t),!1)}catch(e){return console.error("[checkAgentCapability] 检查Agent能力失败:",e),!1}}async function D(){try{const e=await o().get("/api/agent/flags");return e?.success?e:null}catch(t){return console.error("[getAgentFlags] 获取Agent flags失败:",t),null}}async function S(t,e){try{return(await o().post("/api/agent/flags",{lanlan_name:t,flags:e}))?.success!==!1}catch(r){return console.error("[setAgentFlags] 设置Agent flags失败:",r),!1}}async function B(t){try{return(await o().post("/api/agent/admin/control",{action:t}))?.success!==!1}catch(e){return console.error("[controlAgent] Agent控制失败:",e),!1}}async function L(){try{const e=await o().get("/api/agent/task_status");return e?.success?e:null}catch(t){return console.error("[getAgentTaskStatus] 获取Agent任务状态失败:",t),null}}async function k(t){try{return await o().post("/api/proactive_chat",{lanlan_name:t})}catch(e){return console.error("[triggerProactiveChat] 触发主动搭话失败:",e),null}}async function U(){try{return await o().get("/api/steam_language",{timeout:2e3})}catch(t){return console.log("[getSteamLanguage] 无法从 Steam 获取语言设置:",t.message),null}}const c={getPageConfig:p,getCharacters:l,getCurrentCatgirlConfig:h,getLive2DModels:g,findLive2DModelByName:f,shouldReloadModel:q,getEmotionMapping:v,getCurrentLive2DModel:_,getUserPreferences:m,saveUserPreferences:A,unlockSteamAchievement:C,getSteamLanguage:U,setMicrophone:P,getMicrophone:R,analyzeEmotion:I,checkAgentHealth:M,checkAgentCapability:b,getAgentFlags:D,setAgentFlags:S,controlAgent:B,getAgentTaskStatus:L,triggerProactiveChat:k,sendShutdownBeacon:y};function E(){return typeof window>"u"?(console.warn("[RequestAPI] 非浏览器环境"),null):window.request?window.request:(console.warn("[RequestAPI] window.request 未初始化，请确保已加载 request.global.js"),null)}function u(){if(typeof window>"u"){console.warn("[RequestAPI] 非浏览器环境，跳过初始化");return}const t=E();t?w(t):console.warn("[RequestAPI] window.request 未初始化，RequestAPI 可能无法正常工作"),window.RequestAPI=c,console.log("[RequestAPI] API 命名空间已暴露到全局 window.RequestAPI"),console.log("[RequestAPI] 可用方法:",Object.keys(c).join(", "))}if(typeof window<"u"){const t=async()=>{const r=Date.now();for(;!window.request&&Date.now()-r<5e3;)await new Promise(n=>setTimeout(n,50));window.request||console.warn("[RequestAPI] 等待 request.global.js 初始化超时，RequestAPI 可能无法正常工作"),u()};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t()}
